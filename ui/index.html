<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Quiz App</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-white text-blue-900 min-h-screen flex items-center justify-center">
    <!-- Main Container -->
    <div id="quiz-container" class="bg-white p-10 rounded-lg shadow-lg w-full max-w-2xl border border-blue-900">
        <h1 class="text-3xl font-bold mb-4 text-center">Exam Quiz</h1>

        <!-- Progress Bar -->
        <div id="progress-bar" class="w-full bg-gray-300 rounded-full h-4 mb-6">
            <div id="progress" class="bg-blue-900 h-4 rounded-full" style="width: 0%;"></div>
        </div>

        <!-- Question Section -->
        <div id="question-section">
            <p id="question-number" class="text-sm mb-2">Question 1 of 3</p>
            <h2 id="question-text" class="text-xl font-semibold mb-4">Loading...</h2>

            <!-- Options -->
            <form id="options-form" class="space-y-4">
                <!-- Options will be loaded dynamically -->
            </form>

            <!-- Navigation Buttons -->
            <div class="flex justify-between mt-6">
                <button onclick="prevQuestion()"
                    class="bg-blue-900 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-800" disabled
                    id="prev-button">Previous</button>
                <button onclick="nextQuestion()"
                    class="bg-blue-900 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-800"
                    id="next-button">Next</button>
            </div>
        </div>

        <!-- Result Section -->
        <div id="result-section" class="hidden text-center">
            <h2 class="text-3xl font-bold mb-4">Quiz Completed!</h2>
            <p id="score" class="text-xl mb-4"></p>
            <div id="breakdown" class="text-left"></div>
            <button onclick="restartQuiz()"
                class="mt-6 bg-blue-900 text-white px-6 py-2 rounded-md font-semibold hover:bg-blue-800">Restart
                Quiz</button>
        </div>
    </div>

    <script>
        let questions = [];
        let currentQuestion = 0;
        let score = 0;

        // Fetch questions from the API
        async function fetchQuestions() {
            const response = await fetch('http://127.0.0.1:8000/api/questions/');
            const data = await response.json();
            questions = data;
            loadQuestion();
        }

        function loadQuestion() {
            if (questions.length === 0) return;

            const question = questions[currentQuestion];
            document.getElementById('question-number').innerText = `Question ${currentQuestion + 1} of ${questions.length}`;
            document.getElementById('question-text').innerText = question.text;
            const optionsForm = document.getElementById('options-form');
            optionsForm.innerHTML = '';

            question.options.forEach((option, index) => {
                optionsForm.innerHTML += `
          <div>
            <input type="radio" name="option" id="option-${index}" value="${index}" class="mr-2">
            <label for="option-${index}">${option.text}</label>
          </div>
        `;
            });

            updateProgressBar();
            togglePrevButton();
        }

        function nextQuestion() {
            const selectedOption = document.querySelector('input[name="option"]:checked');
            if (!selectedOption) return alert('Please select an answer!');

            const isCorrect = questions[currentQuestion].options[parseInt(selectedOption.value)].is_correct;
            if (isCorrect) {
                score++;
            }

            currentQuestion++;

            if (currentQuestion < questions.length) {
                loadQuestion();
            } else {
                showResult();
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progress').style.width = `${progress}%`;
        }

        function togglePrevButton() {
            document.getElementById('prev-button').disabled = currentQuestion === 0;
        }

        function showResult() {
            document.getElementById('question-section').classList.add('hidden');
            document.getElementById('result-section').classList.remove('hidden');
            document.getElementById('score').innerText = `You scored ${score} out of ${questions.length}`;
            displayBreakdown();
        }

        function displayBreakdown() {
            const breakdown = questions.map((q, index) => {
                const userAnswer = document.querySelector(`input[name="option"]:checked`)?.value;
                const correctAnswer = q.options[q.answer];
                return `<p><strong>Question ${index + 1}:</strong> ${q.text}<br><strong>Correct Answer:</strong> ${correctAnswer}</p>`;
            }).join('');
            document.getElementById('breakdown').innerHTML = breakdown;
        }

        function restartQuiz() {
            currentQuestion = 0;
            score = 0;
            document.getElementById('result-section').classList.add('hidden');
            document.getElementById('question-section').classList.remove('hidden');
            loadQuestion();
        }

        // Load the first question on page load
        fetchQuestions();
    </script>
</body>

</html>